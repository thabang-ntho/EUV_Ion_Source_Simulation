#!/usr/bin/env bash
set -euo pipefail

# Fast test gate before pushing. Skips if CI env var is present.
if [ -n "${SKIP_PREPUSH:-}" ]; then
  echo "[pre-push] Skipped (SKIP_PREPUSH set)"
  exit 0
fi

echo "[pre-push] Running fast tests..."
uv run pytest -q || {
  echo "[pre-push] Tests failed. Use SKIP_PREPUSH=1 to bypass (not recommended)." >&2
  exit 1
}

# Optional: quick smoke (no COMSOL)
echo "[pre-push] Running smoke..."
uv run python src/pp_model.py --check-only --absorption-model fresnel >/dev/null
uv run python src/pp_model.py --check-only --absorption-model kumar >/dev/null

echo "[pre-push] OK"
